<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä¼æ¥­ãƒ‡ãƒ¼ã‚¿ ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ãƒŠãƒ“ã‚²ãƒ¼ã‚¿ãƒ¼</title>
    <meta name="description" content="ç‹¬ç«‹è¡Œæ”¿æ³•äººãƒ»æ”¿åºœç³»é‡‘èæ©Ÿé–¢ã®é–¢ä¿‚æ€§ã‚’å¤šè»¸ã§å¯è¦–åŒ–ã™ã‚‹ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ãƒ†ã‚£ãƒ–ãƒ„ãƒ¼ãƒ«">
    <link rel="stylesheet" href="style.css">
    <script src="https://d3js.org/d3.v7.min.js"></script>
</head>

<body>
    <div class="container">
        <header class="header">
            <h1>ğŸ”— ä¼æ¥­ãƒ‡ãƒ¼ã‚¿ ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ãƒŠãƒ“ã‚²ãƒ¼ã‚¿ãƒ¼</h1>
            <p class="subtitle">ç‹¬ç«‹è¡Œæ”¿æ³•äººãƒ»æ”¿åºœç³»é‡‘èæ©Ÿé–¢ é–¢ä¿‚æ€§ãƒãƒƒãƒ— â”€ å¤šè»¸å¯è¦–åŒ–ç‰ˆ</p>
        </header>

        <!-- ãƒ“ãƒ¥ãƒ¼åˆ‡æ›¿ã‚¿ãƒ– -->
        <div class="view-tabs">
            <button class="view-tab active" data-view="network">ğŸŒ ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯</button>
            <button class="view-tab" data-view="evaluation">ğŸ¯ 5è»¸è©•ä¾¡</button>
            <button class="view-tab" data-view="statistics">ğŸ“Š çµ±è¨ˆåˆ†æ</button>
            <button class="view-tab" data-view="treemap">ğŸ“Š ãƒ„ãƒªãƒ¼ãƒãƒƒãƒ—</button>
            <button class="view-tab" data-view="bubble">ğŸ«§ ãƒãƒ–ãƒ«</button>
            <button class="view-tab" data-view="scatter">ğŸ“ˆ æ•£å¸ƒå›³</button>
            <button class="view-tab" data-view="ranking">ğŸ† ãƒ©ãƒ³ã‚­ãƒ³ã‚°</button>
        </div>


        <div class="controls">
            <div class="control-group">
                <label>ğŸ¨ ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼:</label>
                <select id="filterType">
                    <option value="all">ã™ã¹ã¦è¡¨ç¤º</option>
                    <option value="financial">ğŸ’° é‡‘èæ©Ÿé–¢ã®ã¿</option>
                    <option value="vendor">ğŸ¢ ä¸»è¦ãƒ™ãƒ³ãƒ€ãƒ¼åˆ¥</option>
                    <option value="category">ğŸ“ æ³•äººç¨®åˆ¥</option>
                    <option value="investment">ğŸ’ æŠ•è³‡ä½™åŠ›åˆ¥</option>
                    <option value="ai">ğŸ¤– AIæ´»ç”¨çŠ¶æ³</option>
                </select>
            </div>
            <div class="control-group" id="nodeSizeControl">
                <label>ğŸ“ ãƒãƒ¼ãƒ‰ã‚µã‚¤ã‚º:</label>
                <select id="nodeSize">
                    <option value="employees">è·å“¡æ•°</option>
                    <option value="assets">ç·è³‡ç”£</option>
                    <option value="uniform">å‡ä¸€</option>
                </select>
            </div>
            <div class="control-group">
                <button id="resetZoom" class="btn">ğŸ”„ ãƒªã‚»ãƒƒãƒˆ</button>
                <button id="toggleLabels" class="btn">ğŸ“ ãƒ©ãƒ™ãƒ«</button>
                <button id="exportImage" class="btn btn-export">ğŸ“· ç”»åƒå‡ºåŠ›</button>
            </div>
        </div>

        <div class="main-content">
            <div class="visualization-container" id="visualizationContainer">
                <!-- ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ãƒ“ãƒ¥ãƒ¼ -->
                <div class="view-content active" id="networkView">
                    <div class="network-container" id="networkContainer">
                        <svg id="networkSvg"></svg>
                    </div>
                </div>
                <!-- 5è»¸è©•ä¾¡ãƒ“ãƒ¥ãƒ¼ -->
                <div class="view-content" id="evaluationView"></div>
                <!-- çµ±è¨ˆåˆ†æãƒ“ãƒ¥ãƒ¼ -->
                <div class="view-content" id="statisticsView"></div>
                <!-- ãƒ„ãƒªãƒ¼ãƒãƒƒãƒ—ãƒ“ãƒ¥ãƒ¼ -->
                <div class="view-content" id="treemapView"></div>
                <!-- ãƒãƒ–ãƒ«ãƒãƒ£ãƒ¼ãƒˆãƒ“ãƒ¥ãƒ¼ -->
                <div class="view-content" id="bubbleView"></div>
                <!-- æ•£å¸ƒå›³ãƒ“ãƒ¥ãƒ¼ -->
                <div class="view-content" id="scatterView"></div>
                <!-- ãƒ©ãƒ³ã‚­ãƒ³ã‚°ãƒ“ãƒ¥ãƒ¼ -->
                <div class="view-content" id="rankingView"></div>
            </div>

            <div class="info-panel" id="infoPanel">
                <div class="panel-header">
                    <h3>ğŸ“Š çµ„ç¹”æƒ…å ±</h3>
                </div>
                <div class="panel-content" id="panelContent">
                    <p class="placeholder">ãƒãƒ¼ãƒ‰ã‚’ã‚¯ãƒªãƒƒã‚¯ã™ã‚‹ã¨è©³ç´°ãŒè¡¨ç¤ºã•ã‚Œã¾ã™</p>
                </div>
            </div>
        </div>

        <div class="legend" id="legend">
            <h4>å‡¡ä¾‹</h4>
            <div class="legend-items" id="legendItems"></div>
        </div>

        <div class="stats-bar">
            <div class="stat-item">
                <span class="stat-label">çµ„ç¹”æ•°</span>
                <span class="stat-value" id="totalNodes">0</span>
            </div>
            <div class="stat-item">
                <span class="stat-label">æ¥ç¶šæ•°</span>
                <span class="stat-value" id="totalLinks">0</span>
            </div>
            <div class="stat-item">
                <span class="stat-label">ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼</span>
                <span class="stat-value" id="totalClusters">0</span>
            </div>
            <div class="stat-item highlight-stat">
                <span class="stat-label">ç·è³‡ç”£åˆè¨ˆ</span>
                <span class="stat-value" id="totalAssets">-</span>
            </div>
        </div>
    </div>

    <div class="tooltip" id="tooltip"></div>

    <script src="data.js"></script>
    <script src="views.js"></script>
    <script src="script.js"></script>
    <script>
        // ãƒ“ãƒ¥ãƒ¼åˆ‡æ›¿ã®åˆæœŸåŒ–
        document.addEventListener('DOMContentLoaded', () => {
            const tabs = document.querySelectorAll('.view-tab');
            const views = document.querySelectorAll('.view-content');
            const nodeSizeControl = document.getElementById('nodeSizeControl');

            tabs.forEach(tab => {
                tab.addEventListener('click', () => {
                    const viewName = tab.dataset.view;

                    // ã‚¿ãƒ–ã®ã‚¢ã‚¯ãƒ†ã‚£ãƒ–çŠ¶æ…‹ã‚’æ›´æ–°
                    tabs.forEach(t => t.classList.remove('active'));
                    tab.classList.add('active');

                    // ãƒ“ãƒ¥ãƒ¼ã®è¡¨ç¤º/éè¡¨ç¤ºã‚’åˆ‡æ›¿
                    views.forEach(v => v.classList.remove('active'));
                    document.getElementById(viewName + 'View').classList.add('active');

                    // ãƒãƒ¼ãƒ‰ã‚µã‚¤ã‚ºã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ã®è¡¨ç¤ºåˆ¶å¾¡
                    if (viewName === 'network') {
                        nodeSizeControl.style.display = 'flex';
                    } else {
                        nodeSizeControl.style.display = 'none';
                    }

                    // ãƒ“ãƒ¥ãƒ¼ã‚’ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°
                    renderView(viewName);
                });
            });

            // ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼å¤‰æ›´æ™‚ã«ãƒ“ãƒ¥ãƒ¼ã‚’å†æç”»
            document.getElementById('filterType').addEventListener('change', (e) => {
                window.visualizationViews.currentFilter = e.target.value;
                const activeTab = document.querySelector('.view-tab.active');
                renderView(activeTab.dataset.view);
            });

            // ç·è³‡ç”£åˆè¨ˆã‚’è¨ˆç®—
            const orgs = window.organizationsData || [];
            const totalAssets = orgs.reduce((sum, org) => sum + (org.assets || 0), 0);
            const formatted = totalAssets >= 10000
                ? (totalAssets / 10000).toFixed(1) + 'å…†å††'
                : totalAssets.toLocaleString() + 'å„„å††';
            document.getElementById('totalAssets').textContent = formatted;
        });

        function renderView(viewName) {
            const container = document.getElementById(viewName + 'View');
            const vv = window.visualizationViews;

            switch (viewName) {
                case 'evaluation':
                    vv.renderEvaluation(container);
                    break;
                case 'statistics':
                    vv.renderStatistics(container);
                    break;
                case 'treemap':
                    vv.renderTreemap(container);
                    break;
                case 'bubble':
                    vv.renderBubbleChart(container);
                    break;
                case 'scatter':
                    vv.renderScatterPlot(container);
                    break;
                case 'ranking':
                    vv.renderRanking(container);
                    break;
                // networkã¯NetworkNavigatorã‚¯ãƒ©ã‚¹ã§ç®¡ç†
            }
        }
    </script>
</body>

</html>